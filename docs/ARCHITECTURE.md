# BrowserLeaks.io æ¶æ„è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-15

---

## ğŸ“Œ æ¶æ„æ¦‚è¿°

BrowserLeaks.io é‡‡ç”¨**å‰åç«¯åˆ†ç¦» + è¾¹ç¼˜åŠ é€Ÿ**çš„ç°ä»£åŒ–æ¶æ„ï¼Œå……åˆ†åˆ©ç”¨Cloudflare CDNå’ŒVPSæœåŠ¡å™¨çš„ä¼˜åŠ¿ï¼Œå®ç°å…¨çƒä½å»¶è¿Ÿè®¿é—®å’Œé«˜å¯é æ€§ã€‚

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **æ€§èƒ½ä¼˜å…ˆ**: é¦–å±åŠ è½½ <2ç§’ï¼ŒAPIå“åº” <100ms
2. **å¯æ‰©å±•æ€§**: æ”¯æŒæ°´å¹³æ‰©å±•ï¼Œè½»æ¾åº”å¯¹æµé‡å¢é•¿
3. **å®‰å…¨æ€§**: å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œä¿æŠ¤ç”¨æˆ·éšç§
4. **å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä»£ç å¤ç”¨ç‡é«˜
5. **æˆæœ¬ä¼˜åŒ–**: å……åˆ†åˆ©ç”¨å…è´¹å±‚æœåŠ¡ï¼Œé™ä½è¿è¥æˆæœ¬

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·æµè§ˆå™¨                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ æŒ‡çº¹é‡‡é›†å™¨    â”‚  â”‚ UIç»„ä»¶       â”‚  â”‚ çŠ¶æ€ç®¡ç†      â”‚          â”‚
â”‚  â”‚ (creepjs)   â”‚  â”‚ (React)      â”‚  â”‚ (Zustand)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Cloudflare å…¨çƒç½‘ç»œ                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Cloudflare CDN                        â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Cloudflare Pagesâ”‚         â”‚ Cloudflare Workers  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚                 â”‚         â”‚ (å¯é€‰è¾¹ç¼˜API)        â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Next.js SSG   â”‚         â”‚ â€¢ è½»é‡çº§ç«¯ç‚¹         â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ é™æ€èµ„æº      â”‚         â”‚ â€¢ åœ°ç†ä½ç½®è·¯ç”±       â”‚   â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ è‡ªåŠ¨éƒ¨ç½²      â”‚         â”‚ â€¢ KVå­˜å‚¨            â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VPSæœåŠ¡å™¨ (93.127.133.204)                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     Express APIæœåŠ¡å™¨                      â”‚  â”‚
â”‚  â”‚                      (Port 4000)                          â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ APIè·¯ç”±å±‚                                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ /api/v1/fingerprint                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ /api/v1/detect/ip                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ /api/v1/detect/dns-leak                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ /api/v1/detect/webrtc-leak                      â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ æœåŠ¡å±‚                                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ FingerprintService (æŒ‡çº¹åˆ†æ)                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ IPService (IPæ£€æµ‹)                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ DNSLeakService (DNSæ³„éœ²)                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ WebRTCService (WebRTCæ³„éœ²)                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ PrivacyScoreService (éšç§è¯„åˆ†)                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ ä¸­é—´ä»¶å±‚                                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Authentication (è®¤è¯)                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ RateLimit (é€Ÿç‡é™åˆ¶)                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Validation (å‚æ•°éªŒè¯)                            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ ErrorHandler (é”™è¯¯å¤„ç†)                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Logger (æ—¥å¿—è®°å½•)                                â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL      â”‚  â”‚ Redis           â”‚  â”‚ å¤–éƒ¨API        â”‚  â”‚
â”‚  â”‚ (Port 54322)    â”‚  â”‚ (Port 6379)     â”‚  â”‚                â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚ â€¢ ipinfo.io    â”‚  â”‚
â”‚  â”‚ â€¢ ç”¨æˆ·æ•°æ®      â”‚  â”‚ â€¢ ç¼“å­˜          â”‚  â”‚ â€¢ Cloudflare   â”‚  â”‚
â”‚  â”‚ â€¢ æ£€æµ‹å†å²      â”‚  â”‚ â€¢ ä¼šè¯          â”‚  â”‚   Radar        â”‚  â”‚
â”‚  â”‚ â€¢ API Token     â”‚  â”‚ â€¢ é€Ÿç‡é™åˆ¶      â”‚  â”‚ â€¢ my-ip-data   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ å‰ç«¯æ¶æ„

### æŠ€æœ¯æ ˆ

```typescript
{
  "framework": "Next.js 15",
  "runtime": "React 19",
  "language": "TypeScript 5.7",
  "styling": "Tailwind CSS 4.0",
  "components": "shadcn/ui",
  "stateManagement": "Zustand",
  "dataVisualization": "Chart.js + react-chartjs-2",
  "i18n": "next-intl",
  "pwa": "next-pwa",
  "testing": "Vitest + Playwright"
}
```

### ç›®å½•ç»“æ„

```
apps/web/
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ [locale]/                 # å›½é™…åŒ–è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ layout.tsx            # æ ¹å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ page.tsx              # é¦–é¡µï¼ˆä»ªè¡¨æ¿ï¼‰
â”‚   â”‚   â”œâ”€â”€ tests/                # æ£€æµ‹é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ ip-leak/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dns-leak/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ webrtc-leak/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ canvas-fingerprint/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ webgl-fingerprint/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ... (å…¶ä»–æ£€æµ‹é¡µé¢)
â”‚   â”‚   â”œâ”€â”€ docs/                 # æ–‡æ¡£ä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ api-docs/             # APIæ–‡æ¡£
â”‚   â”‚   â””â”€â”€ blog/                 # åšå®¢
â”‚   â””â”€â”€ api/                      # Next.js API Routes (è½»é‡çº§)
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ components/                   # Reactç»„ä»¶
â”‚   â”œâ”€â”€ ui/                       # shadcn/uiç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ leak-tests/               # æ£€æµ‹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ IPLeakTest.tsx
â”‚   â”‚   â”œâ”€â”€ DNSLeakTest.tsx
â”‚   â”‚   â”œâ”€â”€ WebRTCLeakTest.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ dashboard/                # ä»ªè¡¨æ¿ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ PrivacyScoreCard.tsx
â”‚   â”‚   â”œâ”€â”€ RiskLevelIndicator.tsx
â”‚   â”‚   â”œâ”€â”€ ScanProgress.tsx
â”‚   â”‚   â””â”€â”€ TrendChart.tsx
â”‚   â”œâ”€â”€ layout/                   # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â””â”€â”€ Navigation.tsx
â”‚   â””â”€â”€ shared/                   # å…±äº«ç»„ä»¶
â”‚       â”œâ”€â”€ LoadingSpinner.tsx
â”‚       â”œâ”€â”€ ErrorBoundary.tsx
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ lib/                          # å·¥å…·å‡½æ•°å’Œé…ç½®
â”‚   â”œâ”€â”€ api-client.ts             # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ storage.ts                # LocalStorageå°è£…
â”‚   â”œâ”€â”€ i18n.ts                   # å›½é™…åŒ–é…ç½®
â”‚   â””â”€â”€ utils.ts                  # é€šç”¨å·¥å…·
â”‚
â”œâ”€â”€ stores/                       # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useTestStore.ts           # æ£€æµ‹çŠ¶æ€
â”‚   â”œâ”€â”€ useUIStore.ts             # UIçŠ¶æ€ï¼ˆä¸»é¢˜ã€è¯­è¨€ï¼‰
â”‚   â””â”€â”€ useHistoryStore.ts        # å†å²è®°å½•
â”‚
â”œâ”€â”€ hooks/                        # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ useFingerprint.ts         # æŒ‡çº¹é‡‡é›†Hook
â”‚   â”œâ”€â”€ useIPDetect.ts            # IPæ£€æµ‹Hook
â”‚   â”œâ”€â”€ useDNSLeak.ts             # DNSæ³„éœ²Hook
â”‚   â””â”€â”€ useWebRTCLeak.ts          # WebRTCæ³„éœ²Hook
â”‚
â”œâ”€â”€ types/                        # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ fingerprint.ts
â”‚   â”œâ”€â”€ leak-test.ts
â”‚   â””â”€â”€ api.ts
â”‚
â”œâ”€â”€ public/                       # é™æ€èµ„æº
â”‚   â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ icons/
â”‚   â””â”€â”€ manifest.json             # PWAé…ç½®
â”‚
â”œâ”€â”€ styles/                       # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ globals.css
â”‚
â”œâ”€â”€ next.config.js                # Next.jsé…ç½®
â”œâ”€â”€ tailwind.config.js            # Tailwindé…ç½®
â”œâ”€â”€ tsconfig.json                 # TypeScripté…ç½®
â””â”€â”€ package.json
```

### æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### 1. ä»ªè¡¨æ¿ç»„ä»¶ (PrivacyScoreCard)

```typescript
// components/dashboard/PrivacyScoreCard.tsx
interface PrivacyScoreCardProps {
  score: number;
  riskLevel: 'low' | 'medium' | 'high' | 'critical';
  breakdown: {
    ipPrivacy: number;
    dnsPrivacy: number;
    webrtcPrivacy: number;
    fingerprintResistance: number;
    browserConfig: number;
  };
}

export function PrivacyScoreCard({ score, riskLevel, breakdown }: PrivacyScoreCardProps) {
  return (
    <Card className="w-full">
      <CardHeader>
        <CardTitle>éšç§è¯„åˆ†</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex items-center justify-center">
          {/* ç¯å½¢è¿›åº¦æ¡æ˜¾ç¤ºæ€»åˆ† */}
          <CircularProgress value={score} max={100} />
        </div>
        <RiskLevelBadge level={riskLevel} />
        {/* è¯¦ç»†è¯„åˆ†ç»†åˆ† */}
        <ScoreBreakdown breakdown={breakdown} />
      </CardContent>
    </Card>
  );
}
```

#### 2. æ£€æµ‹ç»„ä»¶åŸºç¡€ç±» (BaseLeakTest)

```typescript
// components/leak-tests/BaseLeakTest.tsx
interface BaseLeakTestProps {
  title: string;
  description: string;
  onComplete?: (result: any) => void;
}

export abstract class BaseLeakTest extends React.Component<BaseLeakTestProps> {
  abstract runTest(): Promise<any>;

  render() {
    return (
      <Card>
        <CardHeader>
          <CardTitle>{this.props.title}</CardTitle>
          <CardDescription>{this.props.description}</CardDescription>
        </CardHeader>
        <CardContent>
          <Button onClick={() => this.runTest()}>
            å¼€å§‹æ£€æµ‹
          </Button>
          {/* ç»“æœæ˜¾ç¤ºåŒºåŸŸ */}
        </CardContent>
      </Card>
    );
  }
}
```

### çŠ¶æ€ç®¡ç† (Zustand)

```typescript
// stores/useTestStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface TestState {
  // å½“å‰æ£€æµ‹çŠ¶æ€
  isScanning: boolean;
  currentTest: string | null;
  progress: number;

  // æ£€æµ‹ç»“æœ
  results: {
    ipLeak?: IPLeakResult;
    dnsLeak?: DNSLeakResult;
    webrtcLeak?: WebRTCLeakResult;
    fingerprint?: FingerprintResult;
    // ... å…¶ä»–æ£€æµ‹ç»“æœ
  };

  // éšç§è¯„åˆ†
  privacyScore: PrivacyScore | null;

  // å†å²è®°å½•
  history: TestResult[];

  // Actions
  startScan: () => void;
  stopScan: () => void;
  updateProgress: (progress: number) => void;
  setResult: (testType: string, result: any) => void;
  calculatePrivacyScore: () => void;
  saveToHistory: () => void;
}

export const useTestStore = create<TestState>()(
  persist(
    (set, get) => ({
      isScanning: false,
      currentTest: null,
      progress: 0,
      results: {},
      privacyScore: null,
      history: [],

      startScan: () => set({ isScanning: true, progress: 0 }),
      stopScan: () => set({ isScanning: false }),
      updateProgress: (progress) => set({ progress }),

      setResult: (testType, result) => set((state) => ({
        results: { ...state.results, [testType]: result }
      })),

      calculatePrivacyScore: () => {
        const { results } = get();
        // è®¡ç®—éšç§è¯„åˆ†é€»è¾‘
        const score = calculateScore(results);
        set({ privacyScore: score });
      },

      saveToHistory: () => {
        const { results, privacyScore } = get();
        const historyItem = {
          timestamp: Date.now(),
          results,
          privacyScore
        };
        set((state) => ({
          history: [historyItem, ...state.history].slice(0, 30)
        }));
      }
    }),
    {
      name: 'browserleaks-test-storage',
      partialize: (state) => ({
        history: state.history
      })
    }
  )
);
```

### APIå®¢æˆ·ç«¯

```typescript
// lib/api-client.ts
import axios from 'axios';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'https://api.browserleaks.io/v1';

class APIClient {
  private client = axios.create({
    baseURL: API_BASE_URL,
    timeout: 10000,
    headers: {
      'Content-Type': 'application/json'
    }
  });

  async detectIP(ip?: string) {
    const response = await this.client.post('/detect/ip', { ip });
    return response.data;
  }

  async detectDNSLeak(testId: string) {
    const response = await this.client.post('/detect/dns-leak', { testId });
    return response.data;
  }

  async detectWebRTCLeak(data: any) {
    const response = await this.client.post('/detect/webrtc-leak', data);
    return response.data;
  }

  async analyzeFingerprint(components: any) {
    const response = await this.client.post('/fingerprint', { components });
    return response.data;
  }
}

export const apiClient = new APIClient();
```

---

## ğŸ”§ åç«¯æ¶æ„

### æŠ€æœ¯æ ˆ

```typescript
{
  "runtime": "Node.js 20+",
  "framework": "Express 5.x",
  "language": "TypeScript 5.7",
  "database": "PostgreSQL 15",
  "cache": "Redis 7",
  "validation": "Zod",
  "orm": "Prisma",
  "testing": "Vitest + Supertest"
}
```

### ç›®å½•ç»“æ„

```
apps/api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app.ts                    # Expressåº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ server.ts                 # HTTPæœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ config.ts                 # é…ç½®ç®¡ç†ï¼ˆZodéªŒè¯ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/                   # è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ index.ts              # è·¯ç”±æ±‡æ€»
â”‚   â”‚   â”œâ”€â”€ fingerprint.ts        # æŒ‡çº¹æ£€æµ‹è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ ip.ts                 # IPæ£€æµ‹è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ dns-leak.ts           # DNSæ³„éœ²è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ webrtc-leak.ts        # WebRTCæ³„éœ²è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ batch.ts              # æ‰¹é‡æ£€æµ‹è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ history.ts            # å†å²æŸ¥è¯¢è·¯ç”±
â”‚   â”‚   â””â”€â”€ auth.ts               # è®¤è¯è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                 # æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚   â”œâ”€â”€ FingerprintService.ts # æŒ‡çº¹åˆ†ææœåŠ¡
â”‚   â”‚   â”œâ”€â”€ IPService.ts          # IPæ£€æµ‹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ DNSLeakService.ts     # DNSæ³„éœ²æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ WebRTCService.ts      # WebRTCæ³„éœ²æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ PrivacyScoreService.ts# éšç§è¯„åˆ†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ HistoryService.ts     # å†å²è®°å½•æœåŠ¡
â”‚   â”‚   â””â”€â”€ WebhookService.ts     # WebhookæœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ clients/                  # å¤–éƒ¨APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ IPInfoClient.ts       # ipinfo.ioå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ CloudflareRadarClient.ts # Cloudflare Radarå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ MyIPDataClient.ts     # my-ip-dataå®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/               # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.ts               # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ rateLimit.ts          # é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ validation.ts         # å‚æ•°éªŒè¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ errorHandler.ts       # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ logger.ts             # æ—¥å¿—ä¸­é—´ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                  # ZodéªŒè¯æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ fingerprint.ts
â”‚   â”‚   â”œâ”€â”€ ip.ts
â”‚   â”‚   â””â”€â”€ common.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                    # TypeScriptç±»å‹
â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”œâ”€â”€ fingerprint.ts
â”‚   â”‚   â””â”€â”€ leak-test.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ cache.ts              # ç¼“å­˜å·¥å…·
â”‚   â”‚   â”œâ”€â”€ hash.ts               # å“ˆå¸Œå·¥å…·
â”‚   â”‚   â””â”€â”€ logger.ts             # æ—¥å¿—å·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ db/                       # æ•°æ®åº“
â”‚       â”œâ”€â”€ prisma/
â”‚       â”‚   â””â”€â”€ schema.prisma     # Prismaæ¨¡å¼
â”‚       â””â”€â”€ migrations/           # æ•°æ®åº“è¿ç§»
â”‚
â”œâ”€â”€ tests/                        # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”‚
â”œâ”€â”€ Dockerfile                    # Dockeré…ç½®
â”œâ”€â”€ docker-compose.yml            # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package.json
```

### æ ¸å¿ƒæœåŠ¡è®¾è®¡

#### 1. æŒ‡çº¹åˆ†ææœåŠ¡

```typescript
// src/services/FingerprintService.ts
import { hash } from '../utils/hash';

export class FingerprintService {
  /**
   * åˆ†ææµè§ˆå™¨æŒ‡çº¹
   */
  async analyze(components: FingerprintComponents): Promise<FingerprintResult> {
    // 1. è®¡ç®—å„ç»„ä»¶å“ˆå¸Œ
    const hashes = {
      canvas: hash(components.canvas),
      webgl: hash(components.webgl),
      audio: hash(components.audio),
      fonts: hash(components.fonts),
      // ... å…¶ä»–ç»„ä»¶
    };

    // 2. è®¡ç®—ç»¼åˆå“ˆå¸Œ
    const fingerprintHash = hash(JSON.stringify(hashes));

    // 3. è®¡ç®—å”¯ä¸€æ€§ï¼ˆä¸æ•°æ®åº“ä¸­çš„æŒ‡çº¹å¯¹æ¯”ï¼‰
    const uniqueness = await this.calculateUniqueness(fingerprintHash);

    // 4. æ£€æµ‹ä¼ªé€ è¿¹è±¡
    const spoofingIndicators = this.detectSpoofing(components);

    // 5. è¯†åˆ«æµè§ˆå™¨ç±»å‹
    const browserType = this.identifyBrowser(components.userAgent);

    // 6. æ£€æµ‹æ— å¤´æµè§ˆå™¨/çˆ¬è™«
    const isHeadless = this.detectHeadless(components);
    const isBot = this.detectBot(components);

    return {
      fingerprintId: `fp_${fingerprintHash}`,
      hash: fingerprintHash,
      confidence: this.calculateConfidence(components),
      uniqueness,
      components: hashes,
      spoofingIndicators,
      browserType,
      isHeadless,
      isBot,
      timestamp: Date.now()
    };
  }

  /**
   * è®¡ç®—å”¯ä¸€æ€§ï¼ˆ0-1ï¼Œè¶Šé«˜è¶Šç‹¬ç‰¹ï¼‰
   */
  private async calculateUniqueness(hash: string): Promise<number> {
    // æŸ¥è¯¢æ•°æ®åº“ä¸­ç›¸åŒæŒ‡çº¹çš„æ•°é‡
    const count = await db.fingerprint.count({
      where: { hash }
    });

    // è®¡ç®—å”¯ä¸€æ€§ï¼ˆç®€åŒ–ç®—æ³•ï¼‰
    return 1 - Math.min(count / 10000, 1);
  }

  /**
   * æ£€æµ‹ä¼ªé€ è¿¹è±¡
   */
  private detectSpoofing(components: any): string[] {
    const indicators: string[] = [];

    // æ£€æµ‹Canvasä¼ªé€ 
    if (this.isCanvasSpoofed(components.canvas)) {
      indicators.push('CanvasæŒ‡çº¹å¯èƒ½è¢«ä¼ªé€ ');
    }

    // æ£€æµ‹æ—¶åŒºä¸ä¸€è‡´
    if (components.timezone !== components.intlTimezone) {
      indicators.push('æ—¶åŒºä¿¡æ¯ä¸ä¸€è‡´');
    }

    // æ£€æµ‹User-Agentä¸å®é™…ç‰¹å¾ä¸ç¬¦
    if (!this.isUserAgentConsistent(components)) {
      indicators.push('User-Agentä¸æµè§ˆå™¨ç‰¹å¾ä¸ç¬¦');
    }

    return indicators;
  }

  /**
   * æ£€æµ‹æ— å¤´æµè§ˆå™¨
   */
  private detectHeadless(components: any): boolean {
    // æ£€æµ‹å¤šä¸ªæ— å¤´æµè§ˆå™¨ç‰¹å¾
    return (
      components.navigator.webdriver ||
      components.window.navigator.plugins.length === 0 ||
      components.window.chrome?.runtime !== undefined
    );
  }

  /**
   * æ£€æµ‹çˆ¬è™«
   */
  private detectBot(components: any): boolean {
    const botPatterns = [
      /bot/i,
      /crawler/i,
      /spider/i,
      /headless/i
    ];

    return botPatterns.some(pattern =>
      pattern.test(components.userAgent)
    );
  }
}
```

#### 2. IPæ£€æµ‹æœåŠ¡

```typescript
// src/services/IPService.ts
import { IPInfoClient } from '../clients/IPInfoClient';
import { CloudflareRadarClient } from '../clients/CloudflareRadarClient';
import { cache } from '../utils/cache';

export class IPService {
  private ipinfoClient = new IPInfoClient();
  private cfRadarClient = new CloudflareRadarClient();

  /**
   * æ£€æµ‹IPåœ°å€ä¿¡æ¯
   */
  async detect(ip: string): Promise<IPLeakResult> {
    // 1. æ£€æŸ¥ç¼“å­˜
    const cacheKey = `ip:${ip}`;
    const cached = await cache.get(cacheKey);
    if (cached) return cached;

    // 2. ä»ä¸»æ•°æ®æºè·å–ï¼ˆipinfo.ioï¼‰
    let result: IPLeakResult;
    try {
      result = await this.ipinfoClient.lookup(ip);
    } catch (error) {
      // 3. å¤‡ç”¨æ•°æ®æºï¼ˆCloudflare Radarï¼‰
      result = await this.cfRadarClient.lookup(ip);
    }

    // 4. æ£€æµ‹VPN/ä»£ç†
    result.privacy = await this.detectProxy(ip);

    // 5. æ£€æµ‹IPä¿¡èª‰
    result.reputation = await this.checkReputation(ip);

    // 6. ç¼“å­˜ç»“æœï¼ˆ5åˆ†é’Ÿï¼‰
    await cache.set(cacheKey, result, 300);

    return result;
  }

  /**
   * æ£€æµ‹VPN/ä»£ç†
   */
  private async detectProxy(ip: string): Promise<PrivacyInfo> {
    // æ£€æµ‹å¤šä¸ªç»´åº¦
    const isDatacenter = await this.isDatacenterIP(ip);
    const isVPN = await this.isVPN(ip);
    const isProxy = await this.isProxy(ip);
    const isTor = await this.isTorExitNode(ip);

    return {
      isProxy,
      isVPN,
      isDatacenter,
      isTor,
      isRelay: false
    };
  }

  /**
   * æ£€æŸ¥IPä¿¡èª‰
   */
  private async checkReputation(ip: string): Promise<ReputationInfo> {
    // è°ƒç”¨å¤šä¸ªé»‘åå•æ•°æ®åº“
    const blacklists = await this.checkBlacklists(ip);

    return {
      score: 100 - blacklists.length * 10,
      isBlacklisted: blacklists.length > 0,
      categories: blacklists
    };
  }
}
```

#### 3. éšç§è¯„åˆ†æœåŠ¡

```typescript
// src/services/PrivacyScoreService.ts
export class PrivacyScoreService {
  /**
   * è®¡ç®—éšç§è¯„åˆ†
   */
  calculate(results: TestResults): PrivacyScore {
    const scores = {
      ipPrivacy: this.calculateIPPrivacy(results.ipLeak),
      dnsPrivacy: this.calculateDNSPrivacy(results.dnsLeak),
      webrtcPrivacy: this.calculateWebRTCPrivacy(results.webrtcLeak),
      fingerprintResistance: this.calculateFingerprintResistance(results.fingerprint),
      browserConfig: this.calculateBrowserConfig(results.fingerprint)
    };

    const total = Object.values(scores).reduce((sum, score) => sum + score, 0);

    return {
      totalScore: total,
      riskLevel: this.getRiskLevel(total),
      breakdown: scores,
      vulnerabilities: this.identifyVulnerabilities(results),
      timeline: []
    };
  }

  /**
   * IPéšç§è¯„åˆ†ï¼ˆ0-20åˆ†ï¼‰
   */
  private calculateIPPrivacy(ipLeak?: IPLeakResult): number {
    if (!ipLeak) return 0;

    let score = 20;

    // VPN/ä»£ç†æ£€æµ‹
    if (ipLeak.privacy.isVPN) score -= 0; // ä½¿ç”¨VPNæ˜¯å¥½äº‹
    if (ipLeak.privacy.isProxy) score -= 5;
    if (ipLeak.privacy.isDatacenter) score -= 5;

    // IPä¿¡èª‰
    if (ipLeak.reputation.score < 50) score -= 5;
    if (ipLeak.reputation.isBlacklisted) score -= 5;

    return Math.max(0, score);
  }

  /**
   * DNSéšç§è¯„åˆ†ï¼ˆ0-15åˆ†ï¼‰
   */
  private calculateDNSPrivacy(dnsLeak?: DNSLeakResult): number {
    if (!dnsLeak) return 0;

    let score = 15;

    // DNSæ³„éœ²æ£€æµ‹
    if (dnsLeak.isLeak) {
      score -= dnsLeak.leakType === 'full' ? 10 : 5;
    }

    // ISP DNSä½¿ç”¨
    const hasISPDNS = dnsLeak.servers.some(s => s.isISP);
    if (hasISPDNS) score -= 3;

    // DoH/DoT
    if (!dnsLeak.dohEnabled && !dnsLeak.dotEnabled) score -= 2;

    return Math.max(0, score);
  }

  /**
   * WebRTCéšç§è¯„åˆ†ï¼ˆ0-15åˆ†ï¼‰
   */
  private calculateWebRTCPrivacy(webrtcLeak?: WebRTCLeakResult): number {
    if (!webrtcLeak) return 0;

    let score = 15;

    // æœ¬åœ°IPæ³„éœ²
    if (webrtcLeak.localIPs.length > 0) score -= 3;

    // å…¬ç½‘IPæ³„éœ²
    if (webrtcLeak.publicIPs.length > 0) score -= 5;

    // mDNSæ³„éœ²
    if (webrtcLeak.mdnsLeak) score -= 4;

    // IPv6æ³„éœ²
    if (webrtcLeak.ipv6Leak) score -= 3;

    return Math.max(0, score);
  }

  /**
   * æŒ‡çº¹æŠµæŠ—è¯„åˆ†ï¼ˆ0-30åˆ†ï¼‰
   */
  private calculateFingerprintResistance(fingerprint?: FingerprintResult): number {
    if (!fingerprint) return 0;

    let score = 30;

    // å”¯ä¸€æ€§æƒ©ç½šï¼ˆè¶Šç‹¬ç‰¹è¶Šå±é™©ï¼‰
    score -= fingerprint.uniqueness * 15;

    // Canvasç‹¬ç‰¹æ€§
    if (fingerprint.components.canvas?.uniqueness > 0.8) score -= 5;

    // WebGLç‹¬ç‰¹æ€§
    if (fingerprint.components.webgl?.uniqueness > 0.8) score -= 5;

    // Audioç‹¬ç‰¹æ€§
    if (fingerprint.components.audio?.uniqueness > 0.7) score -= 3;

    // å­—ä½“ç‹¬ç‰¹æ€§
    if (fingerprint.components.fonts?.uniqueness > 0.6) score -= 2;

    return Math.max(0, score);
  }

  /**
   * æµè§ˆå™¨é…ç½®è¯„åˆ†ï¼ˆ0-20åˆ†ï¼‰
   */
  private calculateBrowserConfig(fingerprint?: FingerprintResult): number {
    if (!fingerprint) return 0;

    let score = 20;

    // Cookieå¯ç”¨
    // æ’ä»¶æ•°é‡ï¼ˆå¤ªå¤šæˆ–å¤ªå°‘éƒ½ä¸å¥½ï¼‰
    // DNTï¼ˆDo Not Trackï¼‰è®¾ç½®
    // éšç§æ¨¡å¼æ£€æµ‹

    return Math.max(0, score);
  }

  /**
   * ç¡®å®šé£é™©ç­‰çº§
   */
  private getRiskLevel(score: number): RiskLevel {
    if (score >= 80) return 'low';
    if (score >= 60) return 'medium';
    if (score >= 40) return 'high';
    return 'critical';
  }
}
```

### æ•°æ®åº“è®¾è®¡ (Prisma)

```prisma
// prisma/schema.prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// API Token
model ApiToken {
  id          String   @id @default(uuid())
  token       String   @unique
  email       String
  tier        TokenTier @default(FREE)
  createdAt   DateTime @default(now())
  expiresAt   DateTime?
  isActive    Boolean  @default(true)

  // ä½¿ç”¨ç»Ÿè®¡
  requestsToday   Int      @default(0)
  requestsMonth   Int      @default(0)
  lastUsedAt      DateTime?

  // å…³è”
  usageRecords    UsageRecord[]

  @@map("api_tokens")
}

enum TokenTier {
  FREE
  STARTER
  PRO
  ENTERPRISE
}

// APIä½¿ç”¨è®°å½•
model UsageRecord {
  id          String   @id @default(uuid())
  tokenId     String
  endpoint    String
  timestamp   DateTime @default(now())
  responseTime Int     // æ¯«ç§’
  statusCode  Int

  token       ApiToken @relation(fields: [tokenId], references: [id])

  @@map("usage_records")
  @@index([tokenId, timestamp])
}

// æŒ‡çº¹è®°å½•ï¼ˆå¯é€‰ï¼‰
model Fingerprint {
  id          String   @id @default(uuid())
  hash        String   @unique
  components  Json
  uniqueness  Float
  confidence  Float
  count       Int      @default(1) // ç›¸åŒæŒ‡çº¹çš„å‡ºç°æ¬¡æ•°
  firstSeen   DateTime @default(now())
  lastSeen    DateTime @default(now())

  @@map("fingerprints")
  @@index([hash])
}

// æ‰¹é‡ä»»åŠ¡
model BatchJob {
  id          String   @id @default(uuid())
  tokenId     String
  status      BatchStatus @default(PROCESSING)
  totalJobs   Int
  completedJobs Int     @default(0)
  results     Json
  webhookUrl  String?
  createdAt   DateTime @default(now())
  completedAt DateTime?

  @@map("batch_jobs")
  @@index([tokenId, status])
}

enum BatchStatus {
  PROCESSING
  COMPLETED
  FAILED
}
```

### ä¸­é—´ä»¶è®¾è®¡

#### 1. è®¤è¯ä¸­é—´ä»¶

```typescript
// src/middleware/auth.ts
import { Request, Response, NextFunction } from 'express';
import { db } from '../db/client';

export async function authMiddleware(
  req: Request,
  res: Response,
  next: NextFunction
) {
  try {
    // ä»è¯·æ±‚å¤´è·å–Token
    const authHeader = req.headers.authorization;
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'INVALID_TOKEN',
          message: 'Missing or invalid authorization header'
        }
      });
    }

    const token = authHeader.substring(7);

    // éªŒè¯Token
    const apiToken = await db.apiToken.findUnique({
      where: { token, isActive: true }
    });

    if (!apiToken) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'INVALID_TOKEN',
          message: 'Invalid or expired token'
        }
      });
    }

    // æ£€æŸ¥è¿‡æœŸæ—¶é—´
    if (apiToken.expiresAt && apiToken.expiresAt < new Date()) {
      return res.status(401).json({
        success: false,
        error: {
          code: 'INVALID_TOKEN',
          message: 'Token has expired'
        }
      });
    }

    // å°†Tokenä¿¡æ¯é™„åŠ åˆ°è¯·æ±‚å¯¹è±¡
    req.apiToken = apiToken;

    // æ›´æ–°æœ€åä½¿ç”¨æ—¶é—´
    await db.apiToken.update({
      where: { id: apiToken.id },
      data: { lastUsedAt: new Date() }
    });

    next();
  } catch (error) {
    next(error);
  }
}
```

#### 2. é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶

```typescript
// src/middleware/rateLimit.ts
import { Request, Response, NextFunction } from 'express';
import { redis } from '../utils/redis';

const RATE_LIMITS = {
  FREE: { requests: 100, period: 86400 }, // 24å°æ—¶
  STARTER: { requests: 10000, period: 2592000 }, // 30å¤©
  PRO: { requests: 100000, period: 2592000 },
  ENTERPRISE: { requests: Infinity, period: 0 }
};

export async function rateLimitMiddleware(
  req: Request,
  res: Response,
  next: NextFunction
) {
  try {
    const apiToken = req.apiToken;
    if (!apiToken) {
      return next();
    }

    const limit = RATE_LIMITS[apiToken.tier];
    const key = `ratelimit:${apiToken.id}`;

    // ä»Redisè·å–å½“å‰ä½¿ç”¨é‡
    const current = await redis.get(key);
    const count = current ? parseInt(current) : 0;

    if (count >= limit.requests) {
      // è¶…è¿‡é™åˆ¶
      const ttl = await redis.ttl(key);
      return res.status(429).json({
        success: false,
        error: {
          code: 'RATE_LIMIT_EXCEEDED',
          message: 'Rate limit exceeded',
          details: {
            limit: limit.requests,
            resetAt: new Date(Date.now() + ttl * 1000).toISOString()
          }
        }
      });
    }

    // å¢åŠ è®¡æ•°
    await redis.incr(key);
    if (count === 0) {
      // ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´
      await redis.expire(key, limit.period);
    }

    // è®¾ç½®å“åº”å¤´
    res.setHeader('X-RateLimit-Limit', limit.requests);
    res.setHeader('X-RateLimit-Remaining', limit.requests - count - 1);
    const resetAt = Date.now() + (await redis.ttl(key)) * 1000;
    res.setHeader('X-RateLimit-Reset', Math.floor(resetAt / 1000));

    next();
  } catch (error) {
    next(error);
  }
}
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### Cloudflare Pages (å‰ç«¯)

```yaml
# .github/workflows/deploy-web.yml
name: Deploy Web to Cloudflare Pages

on:
  push:
    branches: [main]
    paths:
      - 'apps/web/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install

      - name: Build
        run: npm run build --filter=@browserleaks/web
        env:
          NEXT_PUBLIC_API_URL: https://api.browserleaks.io/v1

      - name: Deploy to Cloudflare Pages
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          projectName: browserleaks-web
          directory: apps/web/out
          gitHubToken: ${{ secrets.GITHUB_TOKEN }}
```

### VPS Docker (åç«¯)

```dockerfile
# apps/api/Dockerfile
FROM node:20-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

FROM node:20-alpine

WORKDIR /app

COPY --from=builder /app/dist ./dist
COPY --from=builder /app/package*.json ./
COPY --from=builder /app/prisma ./prisma

RUN npm ci --production

EXPOSE 4000

CMD ["npm", "start"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  api:
    build: ./apps/api
    ports:
      - "4000:4000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://postgres:postgres@postgres:5432/browserleaks
      - REDIS_URL=redis://redis:6379
      - IPINFO_TOKEN=${IPINFO_TOKEN}
      - CLOUDFLARE_RADAR_TOKEN=${CLOUDFLARE_RADAR_TOKEN}
    depends_on:
      - postgres
      - redis
    restart: unless-stopped

  postgres:
    image: postgres:15-alpine
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_DB=browserleaks
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å‰ç«¯ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**: Next.jsè‡ªåŠ¨ä»£ç åˆ†å‰²
2. **å›¾ç‰‡ä¼˜åŒ–**: next/imageè‡ªåŠ¨ä¼˜åŒ–
3. **å­—ä½“ä¼˜åŒ–**: next/fontè‡ªåŠ¨å­—ä½“ä¼˜åŒ–
4. **CDNç¼“å­˜**: Cloudflare CDNå…¨çƒåŠ é€Ÿ
5. **é™æ€ç”Ÿæˆ**: SSGé¢„æ¸²æŸ“é™æ€é¡µé¢

### åç«¯ä¼˜åŒ–

1. **Redisç¼“å­˜**: IPæŸ¥è¯¢ç»“æœç¼“å­˜5åˆ†é’Ÿ
2. **æ•°æ®åº“ç´¢å¼•**: å…³é”®æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
3. **è¿æ¥æ± **: PostgreSQLè¿æ¥æ± å¤ç”¨
4. **å“åº”å‹ç¼©**: gzip/brotliå‹ç¼©
5. **CDNåŠ é€Ÿ**: APIå“åº”é€šè¿‡CDNåŠ é€Ÿ

---

## ğŸ”’ å®‰å…¨æªæ–½

1. **HTTPS**: å…¨ç«™HTTPSåŠ å¯†
2. **CSP**: ä¸¥æ ¼çš„å†…å®¹å®‰å…¨ç­–ç•¥
3. **é€Ÿç‡é™åˆ¶**: é˜²æ­¢APIæ»¥ç”¨
4. **è¾“å…¥éªŒè¯**: Zodä¸¥æ ¼æ ¡éªŒ
5. **SQLæ³¨å…¥é˜²æŠ¤**: Prismaå‚æ•°åŒ–æŸ¥è¯¢
6. **XSSé˜²æŠ¤**: Reactè‡ªåŠ¨è½¬ä¹‰
7. **CSRFé˜²æŠ¤**: SameSite Cookie

---

## ğŸ“ˆ ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—æ”¶é›†

- Winstonæ—¥å¿—åº“
- ç»“æ„åŒ–JSONæ—¥å¿—
- æ—¥å¿—çº§åˆ«ï¼šerror/warn/info/debug

### æ€§èƒ½ç›‘æ§

- PrometheusæŒ‡æ ‡æ”¶é›†
- Grafanaå¯è§†åŒ–
- APIå“åº”æ—¶é—´ç›‘æ§
- æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

### é”™è¯¯è¿½è¸ª

- Sentryé”™è¯¯æŠ¥å‘Š
- å®æ—¶é”™è¯¯å‘Šè­¦
- é”™è¯¯å †æ ˆåˆ†æ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-11-15
