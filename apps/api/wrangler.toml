# Cloudflare Workers Configuration for BrowserLeaks.io API
# This Worker replaces the Express server for serverless deployment

name = "browserleaks-api"
main = "src/worker.ts"
compatibility_date = "2024-12-09"
compatibility_flags = ["nodejs_compat"]
# account_id is provided via CLOUDFLARE_ACCOUNT_ID environment variable or --account-id flag

# Worker settings
workers_dev = true
minify = false

# D1 Database Binding (SQLite-based serverless SQL)
# To enable: Create database with `wrangler d1 create browserleaks-prod`
# Then add configuration:
# [[d1_databases]]
# binding = "DB"
# database_name = "browserleaks-prod"
# database_id = "YOUR_DATABASE_ID_HERE"
# migrations_dir = "migrations"

# KV Namespace for Caching
# To enable: Create namespace with `wrangler kv:namespace create CACHE`
# Then add configuration:
# [[kv_namespaces]]
# binding = "CACHE"
# id = "YOUR_KV_NAMESPACE_ID_HERE"

# KV Namespace for Rate Limiting
# To enable: Create namespace with `wrangler kv:namespace create RATE_LIMIT`
# Then add configuration:
# [[kv_namespaces]]
# binding = "RATE_LIMIT"
# id = "YOUR_KV_NAMESPACE_ID_HERE"

# Environment Variables (non-sensitive, public)
[vars]
NODE_ENV = "production"
API_PORT = "3001" # Not used in Workers, kept for compatibility
CORS_ORIGIN = "https://browserleaks.io"

# Secrets (sensitive values - set with: wrangler secret put <KEY>)
# Run these commands to set secrets:
#   wrangler secret put IPINFO_TOKEN
#   wrangler secret put JWT_SECRET
#   wrangler secret put CLOUDFLARE_RADAR_TOKEN
#
# Required secrets:
# - IPINFO_TOKEN: IPInfo.io API token for IP intelligence
# - JWT_SECRET: Secret key for JWT signing (generate with: openssl rand -base64 32)
# - CLOUDFLARE_RADAR_TOKEN: Cloudflare Radar API token
#
# Optional secrets:
# - CF_WORKER_DNS_BEACON_URL: URL for DNS leak detection beacon
# - CF_WORKER_JA3_URL: URL for JA3 fingerprinting worker

# Custom Domain Routing (configure after DNS setup)
# routes = [
#   { pattern = "api.browserleaks.io/*", zone_name = "browserleaks.io" }
# ]

# Build configuration (disabled for local dev - using direct TS execution)
# [build]
# command = "npm run build"

# Observability
[observability]
enabled = true
